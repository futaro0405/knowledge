# 要件定義
## 目的
管理者がXLSXファイルをアップロードすることで多数のお酒情報を一括で登録できるようにし、個別登録の手間や入力ミスを減少させる。
## 対象
管理画面を操作するadminユーザーのみ
## 機能要件
- ファイルアップロード
	- XLSX形式のファイルのみ対応
	- ドラッグ＆ドロップまたはファイル選択でアップロード
- データパース・検証
	- アップロードしたファイルから各データを読み取る。
	- 必須項目の有無や数値チェックなどの簡易なデータ検証を実施。
- データ登録
	- 登録結果として、成功件数とエラーとなった行の情報をフィードバックする。
	- 検証済みのデータを一括登録する。

# 基本設計
## **フロントエンド**
- お酒詳細画面の改修
    - お酒詳細画面に、新たに一括登録画面への遷移ボタンを追加する。
- お酒一括登録画面の追加
	- XLSXファイルの選択、ドラッグ＆ドロップによる一括登録機能。
    - テンプレートのダウンロード機能を実装。
        - ダウンロードできるテンプレートは「alcohols」と「maker」の2シート構成。
    - アップロード結果（成功件数、エラー内容）の表示。
---
## **バックエンド**
- API提供:
	- 管理画面からアップロードされたXLSXファイルを受け取り、パース、検証、更新処理を実行するAPIを提供。
- 処理フロー:
	- アップロードファイルの検証:
		- ファイル形式およびサイズの検証。
    - **XLSXファイルのパース:**
        
        - テンプレートに準拠した2シート（お酒、メーカー）を対象とする。
            
        
    - **各行のチェックを実施:**
        
        - 必須項目のチェック。
            
        - 数値チェック（例：アルコール度数の範囲など）。
            
        - データ重複チェック（既存データとの重複防止）。
            
        
    - **更新処理:**
        
        - 登録対象は、既存システムのスプレッドシートに対応するDB上のテーブル（登録対象シート）として、以下を含む:
            
            - **alcohols**
                
            - **alcohol_info**
                
            - **alcohol_images**
                
            - **medias**
                
            - **maker**
                
            
        - 検証結果が全行正常な場合、トランザクション管理下で一括更新または登録処理を実施する。
            
        
    - **フィードバック:**
        
        - エラーがある場合は、対象行のエラーメッセージを返し、問題解消後の再アップロードを促す。
            
        
    

---

## **データベース**

- **既存のお酒テーブルの更新:**
    
    - 登録対象は、既存のデータベーステーブルに対応する以下のテーブル:
        
        - alcohols
            
        - alcohol_info
            
        - alcohol_images
            
        - medias
            
        - maker
            
        
    - テンプレートの「お酒」シートは、分割管理されていた各種情報をひとまとめにしており、これらのテーブルへ適切にマッピングされるよう更新処理を実施。
        
    
- **アップロード履歴・エラーログ:**
    
    - アップロード日時、実行者、処理結果（成功／エラー情報）を記録するログテーブルを必要に応じて追加。

