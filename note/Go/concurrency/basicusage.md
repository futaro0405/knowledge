# Goで並行処理(基本編)
## チャネルの性質と状態
チャネルは、その状態によって異なる挙動を示します。主な状態と挙動を以下にまとめます。

### チャネルの主な状態
チャネルと一言でいっても、その種類・状態には様々なものがあります。
#### a. nil チャネル
- 宣言されただけで初期化されていないチャネル
- 例：`var c chan int`
#### b. closed（閉じられた）チャネル
- `close()`関数で閉じられたチャネル

#### c. バッファの状態
- 空のバッファ
- 値が入ったバッファ
- 満杯のバッファ
#### d. 方向性
- 送信専用チャネル
- 受信専用チャネル
- 双方向チャネル

### 状態に応じた挙動
#### a. nil チャネル
- 送信：ブロック（永遠に待機）
- 受信：ブロック（永遠に待機）
- close：パニック
#### b. open（開いている）チャネル
- 送信：バッファに空きがあれば成功、なければブロック
- 受信：値があれば成功、なければブロック
- close：成功（チャネルが閉じられる）
#### c. closed（閉じられた）チャネル
- 送信：パニック
- 受信：バッファに残っている値がある場合はそれを返す、ない場合はゼロ値を返す（ブロックしない）
- close：パニック

### 重要なポイント
- **nil チャネルは常にブロックされる**
	- nilチャネルに対する操作は永遠に待機状態になります。
	- これを利用して特定の操作を無効化することができます。
- **閉じられたチャネルは決してブロックされない**
	- 閉じられたチャネルからの受信は即座に完了します。
	- バッファに値が残っている場合はその値を、なければゼロ値を返します。
- **閉じられたチャネルへの送信はパニックを引き起こす**：
	- 閉じられたチャネルに値を送信しようとするとプログラムがクラッシュします。

これらの性質を理解することで、チャネルを使った並行プログラミングをより効果的に、そして安全に行うことができます。
特に、nilチャネルと閉じられたチャネルの挙動の違いは、プログラムの制御フローを設計する上で重要な要素となります。
## チャネルは同期の手段
チャネル、特にバッファなしチャネルは、データの送受信だけでなく、ゴールーチン間の同期にも使用されます。
これは非常に重要な概念です。

### バッファなしチャネルの同期機能
#### 送信側の挙動
- 受信側が準備できるまで、送信処理がブロックされます。
#### 受信側の挙動
- 送信側が値を送るまで、受信処理がブロックされます。
#### 同期のポイント
- 送信と受信が行われる瞬間が、ゴールーチン間の「待ち合わせ点」となります。

## 実際の例：ソート処理の完了を待つ
Effective Goからの例を簡単に説明すると

1. メインゴールーチン：
    - チャネルを作成します。
    - 別のゴールーチンでソート処理を開始します。
    - 他の作業（`doSomethingForAWhile()`）を行います。
    - チャネルからの受信を待ちます（`<-c`）。
2. ソート用ゴールーチン：
    - ソートを実行します。
    - 完了後、チャネルに値を送信します（`c <- 1`）。
3. 同期のポイント：
    - ソートゴールーチンが値を送信し、メインゴールーチンがその値を受信する瞬間。
    - この時点で、ソートの完了がメインゴールーチンに伝わります。

```go
c := make(chan int)  // Allocate a channel.
// Start the sort in a goroutine; when it completes, signal on the channel.
go func() {
	list.Sort()
	c <- 1  // Send a signal; value does not matter.
}()
doSomethingForAWhile()
<-c   // Wait for sort to finish; discard sent value.
```

### 重要なポイント

- チャネルを使うことで、複雑な同期機構を実装せずに、ゴールーチン間の処理タイミングを調整できます。
- 送受信の値自体は重要でない場合もあります（例では1を送っていますが、これは単なる信号です）。
- この方法は、`sync.WaitGroup`よりも柔軟で、より細かい制御が可能です。

チャネルのこの同期機能を理解し活用することで、並行処理のより効果的で読みやすい設計が可能になります。

