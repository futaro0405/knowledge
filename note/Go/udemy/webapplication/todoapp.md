# App Setup

1. 新しいプロジェクトのセットアップを行います：
    - GOPATH/sourceディレクトリに移動
    - 「gin_todo」という新しいディレクトリを作成
    - 新しいディレクトリに移動
    - 「go mod init」コマンドを実行
2. 先ほど作成したFacebookログインプロジェクトをベースにします：
    - 必要なファイルとディレクトリをFacebookログインプロジェクトからコピー
3. プロジェクト名の参照を更新：
    - main.goファイルを開き、「fb_login」への参照を「gin_todo」に置き換え
4. 必要なパッケージをインストール：
    - ターミナルで「go get .」を実行
5. MySQLの設定：
    - rootユーザーでMySQLコンソールを開く
    - プロジェクト用の新しいユーザーを作成
    - 新しいデータベースを作成
    - 作成したユーザーにデータベースの全権限を付与
    - 「gin_todo」データベースを使用
6. データベーステーブルの作成：
    - usersテーブルを作成（Facebookログインプロジェクトと同じ構造）
    - oauth_usersテーブルを作成
7. プロジェクトの動作確認：
    - サーバーを起動
    - ブラウザで「ログイン」をクリック
    - Facebookアカウントを使用してログイン

この手順により、Facebookログインプロジェクトをベースにした新しい「gin_todo」プロジェクトが設定されました。データベース構造も同様に設定され、基本的なログイン機能が動作することを確認しました。次のステップでは、このベースプロジェクトにTODOリスト機能を追加していくことになるでしょう。

# Build the app

1. TODOアプリの中核機能を構築します。
2. MySQLコンソールで新しいテーブル「todos」を作成：
    - ID (自動増分)
    - ユーザーID（アイテムの所有者）
    - タイトル
    - 詳細
    - 完了フラグ
    - 作成日時、更新日時
    - 削除日時
3. アプリケーションに戻り、新しいモデルファイル「todo.go」を作成：
    - テーブルに基づいてTODO構造体を定義
4. main.goに新しいルートグループ「todos」を作成：
    - "/todos"に対するGET APIを追加
    - コントローラ関数 `controllers.TodosIndex` を指定（まだ実装していない）
5. 「controllers」ディレクトリを作成し、「todos_controller.go」ファイルを作成：
    - `TodosIndex` ハンドラ関数を実装
    - Ginコンテキストを受け取るパラメータを設定
6. セッションからユーザーを取得する機能を実装：
    - 「helpers」ディレクトリを作成し、「utils.go」ファイルを作成
    - `GetUserFromSession` 関数を実装（前のプロジェクトからコードをコピー）
7. `TodosIndex` ハンドラ関数の実装：
    - `GetUserFromSession` を呼び出してサインインユーザーを取得
    - ユーザーがサインインしていない場合、未認証ステータスでTODOインデックスページをレンダリング
    - サインインしている場合、ユーザーのTODOアイテムを取得するモデル関数を呼び出す（まだ実装していない）
    - TODOアイテムをビューに渡してインデックスページをレンダリング

この実装により、TODOアプリの基本的な構造が整いました。次のステップでは、TODOアイテムの取得、作成、更新、削除などの具体的な機能を実装していくことになります。また、ビューテンプレートの作成も必要になるでしょう。

1. modelsに`TodosGetAll`関数を実装：
    - ユーザーポインタを受け取り、TODOアイテムのリストを返す
    - クエリ：削除されていないユーザーのTODOアイテムを、更新日時の降順で取得
2. コントローラーに戻り、ビューテンプレートを作成：
    - `templates/todos`フォルダを作成し、`index.html`ファイルを作成
    - Bootstrapのアコーディオンコンポーネントを使用してTODOリストを表示
3. ビューテンプレートの実装：
    - Bootstrapからアコーディオンのサンプルコードをコピー
    - TODOアイテムをループで表示するよう修正
4. 新しいTODOアイテムを追加するボタンを実装：
    - `/todos/new`へのリンクを追加
5. main.goに新しいルートを追加：
    - GET `/todos/new` → `controllers.TodosNew`
6. `TodosNew`ハンドラ関数を実装：
    - サインインユーザーを取得
    - ユーザーが存在しない場合、未認証エラーを返す
    - 新しいTODOアイテム入力フォームをレンダリング
7. 新しいビューファイル`new.html`を作成：
    - TODOアイテム入力フォームを実装
    - フォーム送信先を`/todos`（POST）に設定
8. main.goに新しいPOSTルートを追加：
    - POST `/todos` → （まだ実装していないハンドラ関数）

この実装により、TODOアイテムの一覧表示と新規作成フォームの基本的な機能が追加されました。次のステップでは、新しいTODOアイテムの作成処理、編集、削除機能などを実装することになるでしょう。また、ユーザーインターフェースの改善や、エラーハンドリングの強化なども考慮に入れると良いでしょう。

1. コントローラーでPOST `/todos`のハンドラを実装：
    - 現在のユーザーを取得し、サインインしていない場合は未認証エラーを返す
    - フォームデータを受け取るための構造体`FormData`を作成（title, detailフィールド）
    - コンテキストからフォームデータを`FormData`構造体にバインド
    - モデル関数`TodoCreate`を呼び出して新しいTODOアイテムを作成
2. モデルに`TodoCreate`関数を実装：
    - 現在のユーザー、タイトル、詳細を受け取り、新しいTODOアイテムを作成
    - 完了フラグを初期状態（false）に設定
    - データベースに新しいエントリを作成
    - 作成したアイテムのアドレスを返す
3. ハンドラ関数で、TODOホームページにリダイレクト
4. サーバーを起動し、ブラウザでテスト：
    - ログイン後、`/todos`にアクセス
    - 「新規作成」ボタンをクリックし、いくつかのエントリを作成
    - アコーディオンの動作を確認（Bootstrapのスクリプトが必要）
5. チェックボックスを使ってタスクの完了/未完了を切り替える機能を実装：
    - main.goに新しいAPI `/todos/complete`を追加
6. コントローラーに新しいハンドラを実装：
    - ユーザーのログイン状態を確認
    - TODOアイテムのIDと状態の2つのパラメータを受け取る
    - このAPIはチェックボックスがクリックされたときに呼び出される

この実装により、TODOアイテムの作成と表示機能が追加され、さらにタスクの完了状態を変更する準備が整いました。次のステップでは、完了状態の変更APIの具体的な実装と、フロントエンドでのイベント処理を行う必要があります。また、エラーハンドリングやユーザー体験の向上も考慮に入れると良いでしょう。

1. JSON形式でデータを受け取るように実装：
    - `JSONData`構造体を作成（ID: uint64, State: bool）
    - ハンドラ関数でJSONデータをこの構造体にバインド
2. モデルに`TodoFind`関数を実装：
    - 現在のユーザーとアイテムIDを受け取り、TODOアイテムを返す
    - データベースからIDとユーザーIDで該当アイテムを検索
3. モデルに`MarkComplete`関数を実装：
    - アイテムの完了状態を更新し、データベースに保存
4. コントローラーのハンドラ関数を完成：
    - TODOアイテムを取得し、状態を更新
    - AJAX呼び出しのため、特別なレンダリングは不要
5. ビュー（TODOリスト）にJavaScript関数を追加：
    - `todoStateChange`関数を実装
    - チェックボックスクリック時に呼び出され、`/todos/complete`にAJAXリクエストを送信
    - チェックボックスのIDからTODOアイテムのIDを抽出
    - IDと新しい状態をJSONエンコードしてリクエスト
6. サーバーを再起動し、ブラウザでテスト：
    - ログイン後、`/todos`にアクセス
    - チェックボックスをクリックしてアイテムの状態を変更
    - ページをリフレッシュして状態が保持されていることを確認

この実装により、TODOアイテムの完了状態をリアルタイムで更新できる機能が追加されました。ユーザーはチェックボックスをクリックするだけで、サーバーサイドでアイテムの状態が更新され、ページのリロードなしで変更が反映されます。次のステップとして、エラーハンドリングの改善やユーザーフィードバックの追加などが考えられます。