# create notes app
![[Pasted image 20241019181404.png]]

1. GOPATH/srcディレクトリに移動します。
2. プロジェクト用の新しいディレクトリを作成し、そのディレクトリに移動します。
3. 「gin-notes」という名前で新しいGoモジュールを初期化します。 正しいコマンドは「go mod init」です（「in mod」ではありません）。
4. 前回の「hello_gin」プロジェクトから、templatesとstaticフォルダをコピーします。これにより、再度作成する手間が省けます。
5. プロジェクトをVS Codeで開きます。
6. headerテンプレートを開き、プロジェクトのタイトルを変更します。 「Notes app」と名付けましょう。
7. 「hello_gin」プロジェクトからmain.goファイルもコピーし、タイトルを変更します。
8. プログラムを実行する前に、ターミナルを開きます。
9. 必要なパッケージをダウンロードし、サーバーを起動します。
10. ブラウザでURLにアクセスします。
11. プログラムが正常に動作することを確認します。



これらの手順により、新しい「Notes app」プロジェクトの基本的なセットアップが完了します。前回のプロジェクトからファイルを再利用することで、効率的に新しいプロジェクトを始めることができます。

# GORM integration

![[Pasted image 20241019183152.png]]

![[Pasted image 20241019183642.png]]

1. GORM（Go Object Relational Mapper）を深く学ぶ前に、データベースとユーザーを作成しましょう。
2. rootユーザーとしてMySQLコンソールを開きます。
3. アプリケーションがデータベースにアクセスするための新しいユーザーを作成します。
4. アプリケーション関連のすべてのテーブルを保持する新しいデータベースを作成します。
5. 作成したユーザーにデータベースへのアクセス権を付与します。
6. 必要なライブラリをインストールします：
    - まず、GORMライブラリをインストールします。
    - MySQLを使用してデータベーステーブルを保存するため、MySQLドライバーもインストールします。

![[Pasted image 20241019183949.png]]

![[Pasted image 20241019184110.png]]

1. コードに戻り、データベースに接続する関数を作成します：
    - 新しいMySQLコネクションを開きます。
    - 接続文字列を入力します（ユーザー名、パスワード、localhost、ポート3306、データベース名「notes」）。
    - UTF-8文字セットを使用します。
    - エラーがあればログを記録し、プログラムを停止します。
2. データベース接続を保存する変数を作成します。
3. プログラムの初期化時にconnectDatabase関数を呼び出します。
4. サーバーを起動します。
5. データベース接続に失敗した場合は、エラーを確認します。
    - この場合、パスワードが間違っていたようです。
6. パスワードを修正します。
7. サーバーを再起動します。

これらの手順により、データベースの設定とアプリケーションとの接続が行われます。パスワードの誤りのような小さな問題も、迅速に特定し修正することが重要です。

# GORM -First data model

![[Pasted image 20241019184625.png]]

1. モデルを作成するために、新しく「models」フォルダを作成します。
2. そのフォルダ内に「note.go」ファイルを作成します。
3. パッケージ名を「models」と定義します。
4. ノートの構造を定義します：
    - ID: プライマリーキー、uint64型、GORMパラメータで主キーと指定
    - Name: string型、GORMパラメータでサイズを指定
    - Content: string型、GORMパラメータでtext型として指定
    - CreatedAt, UpdatedAt: タイムスタンプ用、インデックスを追加
    - DeletedAt: ソフトデリート用、インデックスを追加
5. モデルの定義だけでは実際のテーブルは作成されません。テーブルを作成するには、マイグレーションを実行する必要があります。

![[Pasted image 20241019184716.png]]

![[Pasted image 20241019185228.png]]

1. main.goファイルに戻り、「dbMigrate」関数を作成します：
    - db.AutoMigrate(&models.Note{})を呼び出します
2. main関数内でdbMigrate関数を呼び出します。
3. サーバーを起動します。エラーが発生した場合は、括弧の欠落を修正します。

![[Pasted image 20241019185353.png]]

1. アプリケーションで使用している認証情報でMySQLコンソールを開きます。
2. データベースを選択し、テーブルを表示します。
3. マイグレーションによって「notes」テーブルが作成されたことを確認します。
4. テーブルの構造を確認します：
    - SHOW CREATE TABLE notes; コマンドを使用
5. テーブルがモデルで定義したとおりに作成されていることを確認します（全てのカラムとインデックスを含む）。

この手順により、GORMを使用してモデルを定義し、それに基づいてデータベーステーブルを自動的に作成する方法が示されています。これはコードファーストアプローチと呼ばれ、データベーススキーマの管理を容易にします。

# Model Reorg

![[Pasted image 20241019190152.png]]

![[Pasted image 20241019190329.png]]

1. コードを少し再構成しましょう。
2. main.goファイルにある「connectDatabase」と「dbMigrate」という2つの関数は、main.goに置くのは適切ではありません。
3. これらの関数はデータベースのセットアップに関連しているので、modelsフォルダに移動させましょう。
4. modelsフォルダ内に新しいファイル「setup.go」を作成します。
5. setup.goファイルの先頭に「package models」と記述します。
6. main.goファイルから該当するコードをsetup.goにコピーします。
7. 関数名を変更して、パッケージ外からアクセスできるようにします（main.goから呼び出す必要があるため）。
    - 例：「connectDatabase」→「ConnectDatabase」
    - 例：「dbMigrate」→「DbMigrate」
8. 同じパッケージ内なので、モデルの参照時にパッケージ名を明示する必要はありません。
9. main.goファイルに戻り、関数呼び出しを変更します：
    - 「models.ConnectDatabase()」
    - 「models.DbMigrate()」

この再構成により、コードの構造がより明確になり、関連する機能がグループ化されます。データベース関連の設定がmodelsパッケージにまとめられ、main.goファイルがよりシンプルになります。これは、コードの保守性と可読性を向上させる良い実践です。

# First Controller - Index page

![[Pasted image 20241019190616.png]]



1. 最初のコントローラーを作成します：
    - 「controllers」フォルダを新規作成
    - 「notes_controller.go」ファイルを作成
    - パッケージ名を「controllers」と定義
2. システム内の全ノートを返す関数「NotesIndex」を実装：
    - パラメータとして「*gin.Context」を受け取る

![[Pasted image 20241019221900.png]]

1. モデルに「NotesAll」関数を実装：
    - 「note.go」ファイルに移動
    - 関数「NotesAll」を定義（ノートのリストのポインタを返す）
    - GORMを使用してクエリを作成：削除されていないノートを更新日時の降順で取得

![[Pasted image 20241019222014.png]]

1. コントローラーに戻り、取得したノートデータをHTMLでレンダリング：
    - c.HTML()を使用してステータスコード200とテンプレートを指定
    - 取得したノートデータを渡す

![[Pasted image 20241019222258.png]]

1. インデックスページ用のテンプレートを作成：
    - 「templates/notes」フォルダを作成
    - 「index.html」ファイルを作成
    - 基本構造を「home/index.html」からコピー
    - テンプレートパスを「notes/index.html」に変更
    - 見出しを「All Notes」に変更
    - ノートをループで表示するコードを追加

![[Pasted image 20241019222404.png]]

1. ルートを作成：
    - 「main.go」に移動
    - 「r.GET("/notes", controllers.NotesIndex)」を追加
2. サーバーを起動し、ブラウザで「localhost:8080/notes」にアクセス：
    - ページは表示されるが、ノートがまだ存在しないため何も表示されない
3. 次のビデオでは、ノートを作成するメカニズムを実装する予定

この手順により、基本的なMVCの構造（Model-View-Controller）が実装されました。次のステップでは、実際にデータを作成・保存する機能を追加することで、アプリケーションの機能が拡張されていきます。

# New Note Form Page

![[Pasted image 20241019222947.png]]

1. 新しいルートを作成します：
    - r.GET("/notes/new", controllers.NotesNew) を追加

![[Pasted image 20241019223023.png]]

1. notesControllerに新しい関数を実装します：
    - NotesNew 関数を作成し、*gin.Context をパラメータとして受け取ります
    - この関数は新しいノートを作成するためのフォームをレンダリングします
    - c.HTML() を使用して "notes/new.html" テンプレートをレンダリングします

![[Pasted image 20241019223221.png]]

1. 新しいテンプレートファイルを作成します：
    - templates/notes ディレクトリに new.html を作成
    - テンプレートのパスを定義し、基本構造を index.html からコピーします
2. フォームを追加します：
    - Bootstrap のドキュメントを参照し、基本的なフォームのコードをコピーします
    - フォームを自分たちのニーズに合わせて修正します：
        - 最初の入力フィールドをノートの名前に変更
        - 2番目のフィールドをノートの内容用のテキストエリアに変更
    - フォームのアクション（送信時の処理）を追加します
3. サーバーを起動し、/notes/new にアクセスします：
    - ページの要素は表示されますが、Bootstrap CSSが適用されていないことに気づきます
    - ページを調査し、コンソールでエラーを確認します
    - Bootstrap CSSファイルのパスに問題があることが分かります

![[Pasted image 20241019223457.png]]

1. header.html のCSSのパスを修正します：
    - スラッシュが不足していたため、相対パスで検索していました
2. ページを更新し、Bootstrap CSSが正しく適用されていることを確認します

![[Pasted image 20241019223557.png]]

1. notes/index ページに "New Note" ボタンを追加します：
    - サーバーを再起動し、/notes にアクセスします
    - "New Note" ボタンが表示され、クリックすると /notes/new ページに移動することを確認します

これらの手順により、新しいノートを作成するためのフォームページが実装され、既存のインデックスページからアクセスできるようになりました。次のステップでは、このフォームから実際にデータを保存する機能を実装することになるでしょう。

# New Note Creation

![[Pasted image 20241019224014.png]]

1. ノート新規作成ページで、開発者ツールのNetworkタブを開きます。
2. フォームを送信すると、404エラー（ページが見つかりません）が表示されます。これは予想通りの動作です。まだこのルートを実装していないからです。
3. 送信されたペイロードを確認すると、nameとcontentの2つのパラメータが送られていることがわかります。
4. このルートを実装します：
    - POST APIとして `/notes` に設定します。
    - ハンドラ関数を渡します。
5. NotesControllerに新しい関数を実装します：
    - フォームデータを読み取るために、Ginの`c.PostForm()`メソッドを使用します。
    - nameとcontentの値を取得します。
6. 新しいノートを作成するモデル関数を呼び出します。
7. ノートモデルに新しい関数を実装します：
    - パラメータとしてnameとcontentを受け取ります。
    - 新しいノートのインスタンスを作成し、パラメータを設定します。
    - `db.Create()`を使用してデータベースに新しい行を作成します。
8. コントローラに戻り、エントリが作成された後、ノート一覧ページにリダイレクトします：
    - `c.Redirect()`を使用し、HTTPステータス301（恒久的に移動）で `/notes` にリダイレクトします。
9. サーバーを再起動し、ブラウザでテストします：
    - 新しいノートを作成し、送信すると、ノート一覧ページにリダイレクトされ、作成したノートが表示されます。
10. コンソールにtime.Timeデータ型のエラーが表示される場合：
    - modelsのsetup.goファイルで接続文字列に `parseTime=true` を追加します。
11. サーバーを再起動し、再度テストします。今回はコンソールにエラーが表示されないはずです。
12. MySQLコンソールで、レコードが正しく作成されていることを確認します。

これらの手順により、新しいノートを作成し、データベースに保存する機能が実装されました。また、時間データ型の処理に関する小さな問題も解決されました。