# Code Reorganisation

![[Pasted image 20241021212508.png]]

1. ルートハンドラ("/")のコードを少し再構成します。ユーザーがログインしているかどうかを確認する部分を変更します。
2. 現在レンダラーに書かれているこの機能を、utils.goに移動させます。

![[Pasted image 20241021212611.png]]

1. utils.goに移動し、新しい関数を作成します：
    - 関数名: IsUserLoggedIn
    - パラメータ: context (Ginのコンテキスト)
    - 戻り値: boolean (ユーザーがログインしているかどうか)
2. IsUserLoggedIn関数の実装：
    - コンテキスト内のユーザーIDが0より大きいかどうかをチェックします。
    - 0より大きい場合、ユーザーはログインしていると判断しtrueを返します。
    - そうでない場合はfalseを返します。

![[Pasted image 20241021212653.png]]

![[Pasted image 20241021212721.png]]

1. main.goファイルに移動し、controllers/helpersパッケージをインポートします。
2. ルートハンドラのレンダラー部分で、新しく作成したIsUserLoggedIn関数を呼び出します。

この変更により、ユーザーのログイン状態チェックのロジックが集中化され、コードの再利用性と保守性が向上します。また、メインのハンドラ関数がよりシンプルになり、可読性も向上します。

# Form binding
このビデオでは、Ginが提供する「フォームバインディング」という機能を見ていきます。

![[Pasted image 20241021213442.png]]

1. フォームバインディングは、フォームパラメータの読み取りを容易にする構造体を定義するのに役立ちます。
2. NotesControllerに移動し、NoteCreate ハンドラを確認します。現在はフォームパラメータを個別に読み取っています。
3. フォームの構造体を定義します：
    - 構造体名：FormData
    - フィールド：
        - Name (string型)：フォームのname属性に対応
        - Content (string型)：フォームのcontent属性に対応
4. ハンドラ内でFormData構造体のインスタンスを作成します。
5. `context.Bind()`を呼び出し、フォームデータを構造体にバインドします。
6. これにより、フォームのフィールドが構造体のフィールドにマッピングされます。
7. 個別のPostForm呼び出しを削除し、構造体のフィールドを直接使用します：
    - `data.Name`
    - `data.Content`
8. この方法でフォームバインディングが機能します。ネストされたフォームバインディングも可能です。
9. サーバーを再起動し、アプリケーションをテストします。

フォームバインディングを使用することで、コードがよりクリーンになり、フォームデータの取り扱いが簡単になります。また、バリデーションなどの追加機能も容易に実装できるようになります。

# Route Group
このビデオでは、ルートをグループ化する方法について見ていきます。

![[Pasted image 20241021214122.png]]

1. この機能は、関連するルートを一つの傘下にまとめるのに役立ちます。
2. main.goファイルに移動します。
3. 現在、ノートに関連する多くのルートがあります。これらをグループ化する方法を学びます。
4. 新しいグループを作成します：
    
```go
notes := r.Group("/notes")
```

これにより、"/notes"で始まるすべてのルートをグループ化します。

1. 既存のノート関連のルートをこのグループの下に移動します。
2. グループ化したルートから "/notes" プレフィックスを削除します。 例："/notes/new" → "/new"
3. サーバーを再起動し、アプリケーションをテストして、すべてが正常に機能することを確認します。

# Beautification - Navbar

![[Pasted image 20241021214322.png]]

このビデオは任意の内容で、アプリケーションの見た目を改善します。具体的には、上部にナビゲーションバーを追加します。

1. ナビゲーションバーの構成：
    - 左側：「Notes App」（ホームへのリンク）と「Notes」（ノート一覧へのリンク）ボタン
    - 右側：未ログイン時は「Sign up」と「Login」、ログイン時はユーザーのメールアドレスと「Logout」ボタン
2. Bootstrapのドキュメントからナビゲーションバーのサンプルコードをコピーします。
3. headerテンプレートにコピーしたコードを貼り付け、必要に応じて編集します。

![[Pasted image 20241021214500.png]]

1. ナビゲーションバーの左側を編集：
    - タイトルを「Notes App」に変更し、リンクを「/」に設定
    - 「Home」を「Notes」に変更し、リンクを「/notes」に設定

![[Pasted image 20241021214550.png]]

1. ナビゲーションバーの右側を条件分岐で実装：
    - ユーザーがログインしている場合：メールアドレスとログアウトボタンを表示
    - ログインしていない場合：ログインとサインアップボタンを表示

![[Pasted image 20241021214724.png]]

1. コントローラーからビューにメールアドレスを渡す処理を追加：
    - NotesControllerのレンダリング部分で、current_user.Usernameをemailとして渡す

![[Pasted image 20241021214847.png]]

1. 全てのAPIハンドラーで同様の変更を行うため、ユーティリティ関数を実装：
    - controllers/helpers/utils.goに「SetPayload」関数を作成
    - この関数は、Ginのコンテキストとマップを受け取り、emailフィールドを追加したマップを返す

![[Pasted image 20241021215106.png]]

1. 全てのハンドラー関数で、HTMLレンダリング時にSetPayload関数を使用するように変更

![[Pasted image 20241021215140.png]]

1. main.goのハンドラー関数も同様に変更
2. アプリケーションを再起動し、ブラウザでテスト：
    - 全てのビューでナビゲーションバーが正しく動作することを確認

これらの変更により、アプリケーションのユーザーインターフェースが改善され、ナビゲーションが容易になります。また、ログイン状態に応じて適切な情報とオプションが表示されるようになります。