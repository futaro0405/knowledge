# setup
では、まずプロジェクトを作成しましょう。`Go`をインストール済みであることを確認してください。インストールはとても簡単です。

`golang.org`にアクセスし、`Go`をダウンロードして、自分のマシンに合ったバージョンを選んでください。

ダウンロード後、`Express`に触発されたフレームワークである`Fiber`フレームワークを使用します。

https://docs.gofiber.io/#hello-world
このコードをコピーして、`GoLand`というIDEを開きます。
まず、`go mod init ambassador`というコマンドでプロジェクトを初期化し、このプロジェクトを`ambassador`と呼びます。
これにより、まだ何も記述されていない`go.mod`ファイルが作成されます。

次に、ここで`go`ファイルを作成し、先ほどコピーしたコードを貼り付けます。

```go
package main

import "github.com/gofiber/fiber/v2"

func main() {
	app := fiber.New()

	app.Get("/", func(c *fiber.Ctx) error {
		return c.SendString("Hello, World!")
	})

	app.Listen(":3000")
}
```

このパッケージがない場合は、以下のように追加してください。

```bash
go mod tidy
```

ライブラリをダウンロード・インストールして、`go.mod`も更新されます。
ここで`go run main.go`を実行すると、プロジェクトがポート3000で動作し、「Hello World」と表示されます。

# Docker
これで最初のシンプルなアプリを正常に実行できたので、このプロジェクトをDockerで構成していきましょう。`docker.com/products/docker-desktop`にアクセスして、自分のマシンに適したインストーラーをダウンロードしてください。

私はMacを使用していますが、Windows版やLinux版もダウンロードできます。
インストールが完了すると、Macを使用している場合は、画面上部にアイコンが表示されます。
Dockerをインストールしたら、このプログラムを実行するために2つのファイルを作成する必要があります。
1つは`docker-compose.yml`ファイルで、もう1つは`Dockerfile`です。

これらの違いは何かというと、`Dockerfile`はこのアプリを構成するためのもので、環境をそのファイル内に記述します。
一方、`docker-compose.yml`ファイルは、このプロジェクトと使用するデータベース（ここではMySQL）を接続するためのものです。

まずは`Dockerfile`から始めましょう。

`Dockerfile`内には、Goの開発環境を指定し、使用するGoのバージョンも明記する必要があります。
私は現時点での最新バージョンを使用します。これがGoのプロジェクトであることをDockerに伝えます。

次に、作業ディレクトリを指定します。`/app`と呼びますが、名前は特に重要ではありません。
次に、`go.mod`ファイルをコピーします。

```Dockerfile
COPY go.mod .
```

これは、このプロジェクトの`go.mod`ファイルを作業ディレクトリにコピーすることを意味します。
`go.sum`ファイルも同じようにコピーします。

```Dockerfile
COPY go.sum .
```

これらのファイルをプロジェクトに追加しましたので、次にパッケージを一括で取得する必要があります。
コマンドを実行してパッケージをダウンロードします。

```Dockerfile
RUN go mod download
```

これにより、パッケージを1つずつ追加する必要はありません。
`go.mod`に記載されたパッケージがDockerコンテナ内にダウンロードされます。

最後に、すべてのファイルをコピーします。

```Dockerfile
COPY . .
```

これでプロジェクト内のすべてのファイルをDockerコンテナ内にコピーします。

最後にコマンドを実行します。

```Dockerfile
CMD ["go", "run", "main.go"]
```

これで`Dockerfile`は完了です。
このファイルでは、環境を設定し、パッケージをダウンロードし、`main.go`を実行するようにしています。
非常にシンプルです。

次に、`docker-compose.yml`ファイルに移りましょう。

ここではバージョンを指定する必要があります。
最新のバージョンは`3.9`です。

```yaml
version: '3.9'
```

次に、サービスを指定します。
この講義ではバックエンドサービスのみ追加します。

```yaml
services:
	backend:
		build: .
```

`build: .`は、この`Dockerfile`を使用してバックエンドをビルドすることを意味します。
何も指定しなくても`Dockerfile`が使用されますが、もし`Dockerfile`の名前を変更した場合は、ここで指定する必要があります。

次にポートを設定します。

```yaml
`ports:
	- "8000:3000"`
```

この設定で、ポート3000を8000で使用するように変更します。

ここで直接ポートを変更します。

```yaml
ports:
	- "8000:3000"
```

この設定は、コンテナ内のポート3000を、ローカルマシンのポート8000にマッピングすることを意味します。
つまり、プロジェクトがポート3000で実行されると、そのコンテナ内でこのポートが使用され、ローカルマシン側ではポート8000としてアクセスされます。

これがどのように機能するかは、プロジェクトを実行する際に確認できます。

次に、ボリュームについてです。

```yaml
volumes:
	- .:/app
```

この設定は、現在のディレクトリ（`.`）をコンテナ内の`/app`ディレクトリにマッピングします。
つまり、作業ディレクトリです。

これにより、ファイルに変更を加えた場合、その変更がコンテナ内にも反映されます。
また、コンテナ内でファイルが変更されれば、ローカルにも反映されます。
これにより、変更が双方向にマッピングされます。

ここまでで設定は完了です。
このプロジェクトを実行するには、以下のコマンドを入力します。

```bash
docker compose up
```

これにより、デフォルトのネットワークが作成され、ネットワークを指定していなくても問題ありません。
そして、Goとその他のパッケージがダウンロードされます。
モジュールがダウンロードされているのが確認できます。

ご覧のとおり、FiberアプリがDockerコンテナ内でポート3000で実行されているのが確認できます。
しかし、ローカルホストでポート3000にアクセスしても何も表示されません。
なぜでしょうか？

それは、ポートを8000にマッピングしたからです。
ポート8000にアクセスすると、「Hello World」が表示されます。
ポート3000はコンテナ内のものなので、ローカルホストでアクセスするためにはポート8000を使う必要があります。

ここでポートを8000に統一して、Dockerコンテナを再起動する必要があります。
混乱を避けるために、コンテナ内とローカルホストの両方でポート8000を使用するようにします。

これでDockerとの接続は成功しました。
次のチュートリアルでは、データベースの追加を行います。

