# OSコマンドインジェクション
OSコマンドインジェクションとは、シェル（/bin/sh)呼び出し可能な機能を悪用して攻撃者が勝手にコマンドをサーバー上で実行できる脆弱性のこと。
## 具体例
### 脆弱なスクリプト
```sh
system("/usr/sbin/sendmail <mail.txt #{mail}");
```

`mail='a@example.jp; cat /etc/password';`を設定した場合
```sh
/usr/sbin/sendmail <mail.txt a@example.jp; cat /etc/password
```
sendmailに続いて`cat /etc/password`が実行される
## 影響
- 任意のコマンドが実行されてしまうため影響は非常に大きい
- wgetコマンド等を利用し攻撃スクリプトを外部からダウンロードされる
- 外部からは攻撃できないが、内部からは攻撃できる脆弱性による[[権限昇格]]からの権限奪取
- ファイルの改ざん、削除、作成
- システムの停止
- 外部サーバーに対する攻撃（踏み台）
## 対策
- 外部コマンドを起動する実装を避ける
- シェルの呼び出し機能のある関数を避ける
	- Open3.capture3('command', parameter) # コマンドとパラメータを分離する
	- kernel#open()やFile.read()はパイプ記号でコマンドを起動できる
		- 例：File.read("|cat /etc/passwd")
- 外部からのパラメータをコマンドラインに渡さない
	- 例：sendmailコマンドの`-t`オプション
# クロスサイト・リクエストフォージェリ（CSRF）
## CSRFとは
formのactionってクロスドメインで指定できる
そのため、formを踏ませる罠が作れる
投稿、パスワード変更、購入、設定変更
攻撃者はformの実行結果は見られないので、DB更新や削除などが問題となる
最悪ケースの危険性は、SQLインジェクションやXSSほどではない
脆弱性のあるページの機能の悪用にとどまる
脆弱性の発見が容易
脆弱性の悪用が容易
実際に悪用されている
## 対策
- Ruby on RailsはGET以外のリクエスト全てにトークンを要求する
- 素直にRuby on Railsを使う限り、CSRF脆弱にする方が難しい
- 脆弱性が混入する主なパターン
	- トークンのチェックを無効かしてしまった
	- Railsの流儀に従わずに処理を書いた
	- わざとCSRFチェックを無効化する
# クロスサイト・スクリプティング（XSS）
攻撃者が攻撃対象のページにJavaScriptを勝手に埋め込める脆弱性
## XSS脆弱にする方法
Ruby on Railsは基本的にXSS対策がなされている
URLを指定するhref属性やsrc属性にJavaScriptスキームを入力する

以下を使えば、HTMLエスケープされないのでXSS脆弱になる
- `<%== 文字列 %>`
- `<% raw 文字列 %>
- `<% 文字列.html_safe %>`
## XSSはなぜ危険か
XSSは
- 利用者（被害者）のブラウザ上