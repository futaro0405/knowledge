# 静的レンダリングと動的レンダリング
前章では、ダッシュボード概要ページのデータを取得しました。  
しかし、現在のセットアップには2つの制限があることを簡単に議論しました：  

1. データリクエストが意図しないウォーターフォールを作成している。
2. ダッシュボードが静的なため、データの更新がアプリケーションに反映されない。

この章では... 以下のトピックを扱います：  

- 静的レンダリングとは何か、そしてそれがどのようにアプリケーションのパフォーマンスを向上させるか。
- 動的レンダリングとは何か、そしていつ使用するべきか。
- ダッシュボードを動的にするための異なるアプローチ。
- 遅いデータフェッチをシミュレートして何が起こるかを確認する。

# 静的レンダリングとは何か？
静的レンダリングでは、データの取得とレンダリングはビルド時（デプロイ時）または [データの再検証](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#revalidating-data)時にサーバー上で行われます。  

ユーザーがアプリケーションにアクセスするたびに、キャッシュされた結果が提供されます。  
静的レンダリングには以下のような利点があります：  

- **高速なウェブサイト** - 事前にレンダリングされたコンテンツはキャッシュされ、グローバルに配信されます。これにより、世界中のユーザーがより迅速かつ確実にウェブサイトのコンテンツにアクセスできます。
- **サーバー負荷の軽減** - コンテンツがキャッシュされるため、各ユーザーリクエストに対して動的にコンテンツを生成する必要がありません。
- **SEO** - 事前にレンダリングされたコンテンツは、ページ読み込み時にすでに利用可能なため、検索エンジンのクローラーがインデックスを作成しやすくなります。これにより検索エンジンランキングが向上する可能性があります。

静的レンダリングは、**データがない**UIや**ユーザー間で共有されるデータ**（静的なブログ投稿や商品ページなど）に適しています。  
定期的に更新される個人化されたデータを持つダッシュボードには適していない可能性があります。  

静的レンダリングの反対は動的レンダリングです。  

# 動的レンダリングとは何か？
動的レンダリングでは、コンテンツは**リクエスト時**（ユーザーがページにアクセスしたとき）に各ユーザーに対してサーバー上でレンダリングされます。  

動的レンダリングには以下のような利点があります：

- **リアルタイムデータ** - 動的レンダリングにより、アプリケーションはリアルタイムまたは頻繁に更新されるデータを表示できます。これはデータが頻繁に変更されるアプリケーションに理想的です。
- **ユーザー固有のコンテンツ** - ダッシュボードやユーザープロファイルなどの個人化されたコンテンツを提供し、ユーザーの操作に基づいてデータを更新するのが容易になります。
- **リクエスト時の情報** - 動的レンダリングにより、クッキーやURLの検索パラメータなど、リクエスト時にのみ知ることができる情報にアクセスできます。

# 遅いデータフェッチのシミュレーション
私たちが構築しているダッシュボードアプリケーションは動的です。  

しかし、前章で述べた問題がまだ1つあります。  
1つのデータリクエストが他のすべてよりも遅い場合、どうなるでしょうか？  

遅いデータフェッチをシミュレートしてみましょう。  
`data.ts`ファイルで、`fetchRevenue()`内の`console.log`と`setTimeout`のコメントを解除してください：  

**/app/lib/data.ts**
```javascript
export async function fetchRevenue() {
  try {
    // We artificially delay a response for demo purposes.
    // Don't do this in production :)
    console.log('Fetching revenue data...');
    await new Promise((resolve) => setTimeout(resolve, 3000));
 
    const data = await sql<Revenue>`SELECT * FROM revenue`;
 
    console.log('Data fetch completed after 3 seconds.');
 
    return data.rows;
  } catch (error) {
    console.error('Database Error:', error);
    throw new Error('Failed to fetch revenue data.');
  }
}
```

次に、新しいタブで [http://localhost:3000/dashboard/](http://localhost:3000/dashboard/) を開き、ページの読み込みに時間がかかることに注目してください。  
ターミナルには以下のメッセージが表示されるはずです：  

```bash
Fetching revenue data...
Data fetch completed after 3 seconds.
```

ここでは、遅いデータフェッチをシミュレートするために、人為的な3秒の遅延を追加しました。  
その結果、データが取得されている間、訪問者にUIを表示できなくなっています。  
これは開発者が解決しなければならない一般的な課題につながります：  

動的レンダリングでは、**アプリケーションの速度は最も遅いデータフェッチの速度と同じになります。**  

