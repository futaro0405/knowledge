# アクセシビリティの向上
前章では、エラー（404エラーを含む）をキャッチしてユーザーにフォールバックを表示する方法を見てきました。  
しかし、まだ解決すべき別の部分があります：フォームのバリデーションです。  
Server Actionsを使用したサーバーサイドのバリデーションの実装方法と、Reactの`useActionState`フックを使用してフォームエラーを表示する方法を、アクセシビリティを念頭に置きながら見ていきましょう！  

この章では... 以下のトピックを扱います：  

1. Next.jsで`eslint-plugin-jsx-a11y`を使用してアクセシビリティのベストプラクティスを実装する方法。
2. サーバーサイドのフォームバリデーションを実装する方法。
3. Reactの`useActionState`フックを使用してフォームエラーを処理し、ユーザーに表示する方法。

これらのトピックを通じて、アプリケーションのアクセシビリティを向上させ、より良いユーザー体験を提供する方法を学びます。  
フォームのバリデーションとエラー表示は、ユーザビリティとアクセシビリティの両面で重要な要素です。  

# アクセシビリティとは何か？
アクセシビリティとは、障害のある人を含むすべての人が使用できるようにウェブアプリケーションを設計し実装することを指します。  
これは、キーボードナビゲーション、セマンティックHTML、画像、色、動画など、多くの領域をカバーする広範なトピックです。  

このコースではアクセシビリティについて深く掘り下げませんが、Next.jsで利用可能なアクセシビリティ機能と、アプリケーションをよりアクセシブルにするためのいくつかの一般的な実践方法について説明します。  

> アクセシビリティについてさらに学びたい場合は、[web.dev](https://web.dev/)による「[Learn Accessibility](https://web.dev/learn/accessibility/)」コースをお勧めします。  

# Next.jsでのESLintアクセシビリティプラグインの使用
Next.jsは、アクセシビリティの問題を早期に発見するためにESLint設定に`eslint-plugin-jsx-a11y`プラグインを含んでいます。  
このプラグインは、`alt`テキストのない画像、`aria-*`および`role`属性の不適切な使用などを警告します。  

オプションとして、これを試したい場合は、`package.json`ファイルに`next lint`をスクリプトとして追加してください：  

**/package.json**
```json
"scripts": {
    "build": "next build",
    "dev": "next dev",
    "start": "next start",
    "lint": "next lint"
},
```

そして、ターミナルで`pnpm lint`を実行します：

```Terminal
pnpm lint
```

これにより、プロジェクトのESLintのインストールと設定が案内されます。  
今`pnpm lint`を実行すると、以下の出力が表示されるはずです：  

```terminal
✔ No ESLint warnings or errors
```

しかし、`alt`テキストのない画像があった場合はどうなるでしょうか？試してみましょう！  
`/app/ui/invoices/table.tsx`に移動し、画像から`alt`プロパティを削除します。  
エディタの検索機能を使って`<Image>`をすぐに見つけることができます：  

**/app/ui/invoices/table.tsx**
```jsx
<Image
  src={invoice.image_url}
  className="rounded-full"
  width={28}
  height={28}
  alt={`${invoice.name}'s profile picture`} // Delete this line
/>
```

ここで再度`pnpm lint`を実行すると、以下の警告が表示されるはずです：

```terminal
./app/ui/invoices/table.tsx
45:25  Warning: Image elements must have an alt prop,
either with meaningful text, or an empty string for decorative images. jsx-a11y/alt-text
```

リンターの追加と設定は必須のステップではありませんが、開発プロセスでアクセシビリティの問題を発見するのに役立ちます。  

# フォームのアクセシビリティ改善
フォームのアクセシビリティを向上させるために、すでに以下の3つのことを行っています：  

1. **セマンティックHTML**: `<div>`の代わりにセマンティック要素（`<input>`, `<option>`など）を使用しています。これにより支援技術（AT）が入力要素に焦点を当て、ユーザーに適切な文脈情報を提供できるようになり、フォームのナビゲーションと理解が容易になります。
2. **ラベリング**: `<label>`と`htmlFor`属性を含めることで、各フォームフィールドに説明的なテキストラベルが付けられます。これにより文脈を提供してAT対応が向上し、ユーザーがラベルをクリックして対応する入力フィールドにフォーカスできるようになり、使いやすさも向上します。
3. **フォーカスアウトライン**: フィールドがフォーカスされたときにアウトラインが表示されるように適切にスタイリングされています。これはページ上のアクティブな要素を視覚的に示すため、キーボードユーザーとスクリーンリーダーユーザーの両方がフォーム上の位置を理解するのに役立つ、アクセシビリティにとって重要な要素です。`tab`キーを押すことで確認できます。

これらの実践は、多くのユーザーにとってフォームをよりアクセシブルにするための良い基盤となります。  
しかし、**フォームのバリデーション**と**エラー**については対応していません。  

# フォームバリデーション
`http://localhost:3000/dashboard/invoices/create`にアクセスし、空のフォームを送信してみてください。  
何が起こるでしょうか？  

エラーが発生します！  
これは、空のフォーム値をServer Actionに送信しているためです。  
クライアントまたはサーバーでフォームを検証することで、これを防ぐことができます。  

## クライアントサイドバリデーション
クライアントでフォームを検証する方法はいくつかあります。  
最も簡単な方法は、フォームの`<input>`と`<select>`要素に`required`属性を追加して、ブラウザが提供するフォームバリデーションに依存することです。  

例えば：

**/app/ui/invoices/create-form.tsx**
```jsx
<input
  id="amount"
  name="amount"
  type="number"
  placeholder="Enter USD amount"
  className="peer block w-full rounded-md border border-gray-200 py-2 pl-10 text-sm outline-2 placeholder:text-gray-500"
  required
/>
```

フォームを再度送信してみてください。  
空の値でフォームを送信しようとすると、ブラウザが警告を表示します。  

この方法は一般的に問題ありません。一部の支援技術がブラウザのバリデーションをサポートしているためです。

クライアントサイドバリデーションの代替として、サーバーサイドバリデーションがあります。次のセクションでその実装方法を見ていきましょう。今のところ、`required`属性を追加した場合は削除してください。